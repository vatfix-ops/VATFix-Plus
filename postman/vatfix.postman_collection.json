{
  "info": {
    "_postman_id": "1f6f7a2b-0c2e-41ef-9b2c-f7f5a2b9d001",
    "name": "VATFix Plus — Public API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "EU VAT format check transport (VIES with cache). Most users only need the **Customer API** folder.\n\n**Base URL**: {{baseUrl}}\n\n**Headers**\n• VAT transport (`POST /vat/lookup`) → `x-api-key` + `x-customer-email`\n• Customer key rotation (`POST /reset`) → `x-api-key` + `x-customer-email` (no bearer required)\n\n**Common errors**\n`missing_api_key`, `missing_customer_email`, `invalid_api_key`, `rate_limit_exceeded`, `access_denied`, `plan_not_allowed`.\n\n**Rate limit**: 120 requests/min per key.\n\nTip: run the requests top-to-bottom; tests will save new keys automatically to your environment.\n\n**Non-authoritative:** Technical format checks only. Not validation. Not compliance. Not legal determination."
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Public-safe defaults (don't overwrite if already set)",
          "const def = (k,v)=>{ if(!pm.collectionVariables.get(k)) pm.collectionVariables.set(k,v); };",
          "def('baseUrl','https://plus.vatfix.eu');",
          "def('customerEmail','developer@example.com');",
          "def('countryCode','DE');",
          "def('vatNumber','12345678901');"
        ]
      }
    }
  ],
  "variable": [
    { "key": "baseUrl", "value": "https://plus.vatfix.eu", "type": "string" },
    { "key": "apiKey", "value": "", "type": "string" },
    { "key": "customerEmail", "value": "developer@example.com", "type": "string" },
    { "key": "countryCode", "value": "DE", "type": "string" },
    { "key": "vatNumber", "value": "12345678901", "type": "string" }
  ],
  "item": [
    {
      "name": "0 • Quickstart & Status",
      "item": [
        {
          "name": "Status JSON",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{baseUrl}}/status.json", "host": ["{{baseUrl}}"], "path": ["status.json"] },
            "description": "Simple health probe (region + host)."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('HTTP 200',()=>pm.expect(pm.response.code).to.eql(200));",
                  "const j = pm.response.json();",
                  "pm.test('Has status ok',()=>pm.expect(j.status).to.eql('ok'));",
                  "console.log('Status:', j);"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Homepage (Docs)",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{baseUrl}}/", "host": ["{{baseUrl}}"], "path": [""] },
            "description": "Marketing homepage & Quickstart."
          },
          "response": []
        }
      ]
    },
    {
      "name": "1 • Customer API",
      "description": "For paying customers & normal users. **No Bearer** header required.",
      "item": [
        {
          "name": "Lookup VAT",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-api-key", "value": "{{apiKey}}", "type": "text" },
              { "key": "x-customer-email", "value": "{{customerEmail}}", "type": "text" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"countryCode\": \"{{countryCode}}\",\n  \"vatNumber\": \"{{vatNumber}}\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/vat/lookup", "host": ["{{baseUrl}}"], "path": ["vat", "lookup"] },
            "description": "Validate a VAT ID (VIES or cached). Requires `x-api-key` + `x-customer-email`."
          },
          "response": [
            {
              "name": "200 OK — Valid (example)",
              "code": 200,
              "status": "OK",
              "_postman_previewlanguage": "json",
              "header": [{ "key": "Content-Type", "value": "application/json" }],
              "body": "{\n  \"countryCode\": \"DE\",\n  \"vatNumber\": \"12345678901\",\n  \"valid\": true,\n  \"name\": \"ACME GmbH\",\n  \"address\": \"Berlin, Germany\",\n  \"requestDate\": \"2025-08-27+02:00\",\n  \"source\": \"vies\"\n}"
            },
            {
              "name": "200 OK — Invalid (example)",
              "code": 200,
              "status": "OK",
              "_postman_previewlanguage": "json",
              "header": [{ "key": "Content-Type", "value": "application/json" }],
              "body": "{\n  \"countryCode\": \"DE\",\n  \"vatNumber\": \"12345678901\",\n  \"valid\": false,\n  \"name\": \"\",\n  \"address\": \"\",\n  \"requestDate\": \"2025-08-27+02:00\",\n  \"source\": \"vies\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 200',()=>pm.expect(pm.response.code).to.eql(200));",
                  "const json = pm.response.json();",
                  "pm.test('Has valid flag',()=>pm.expect(json).to.have.property('valid'));",
                  "const remain = pm.response.headers.get('X-Rate-Remaining');",
                  "if(remain) console.log('X-Rate-Remaining:', remain);",
                  "",
                  "// Visualizer: quick summary",
                  "const template = `",
                  "<style>body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial} .b{font-weight:600} code{background:#f6f7f9;padding:2px 4px;border-radius:4px}</style>",
                  "<h3>VAT Lookup Result</h3>",
                  "<div><span class='b'>Country:</span> {{country}} &nbsp; <span class='b'>VAT:</span> <code>{{vat}}</code></div>",
                  "<div><span class='b'>Valid:</span> {{valid}}</div>",
                  "{{#if name}}<div><span class='b'>Name:</span> {{name}}</div>{{/if}}",
                  "{{#if address}}<div><span class='b'>Address:</span> {{address}}</div>{{/if}}",
                  "<div><span class='b'>Source:</span> {{source}} &nbsp; <span class='b'>Date:</span> {{date}}</div>",
                  "`;",
                  "pm.visualizer.set(template,{",
                  "  country: json.countryCode,",
                  "  vat: json.vatNumber,",
                  "  valid: String(json.valid),",
                  "  name: json.name,",
                  "  address: json.address,",
                  "  source: json.source,",
                  "  date: json.requestDate",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Reset Key (customer rotation)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-api-key", "value": "{{apiKey}}", "type": "text" },
              { "key": "x-customer-email", "value": "{{customerEmail}}", "type": "text" }
            ],
            "url": { "raw": "{{baseUrl}}/reset", "host": ["{{baseUrl}}"], "path": ["reset"] },
            "description": "Rotate your customer key; old key is revoked. **No Bearer** header needed."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 200',()=>pm.expect(pm.response.code).to.eql(200));",
                  "const j = pm.response.json();",
                  "pm.test('Rotated true + new apiKey',()=>{ pm.expect(j).to.have.property('apiKey'); pm.expect(j.rotated).to.eql(true); });",
                  "if(j.apiKey){",
                  "  pm.environment.set('apiKey', j.apiKey);",
                  "  pm.collectionVariables.set('apiKey', j.apiKey);",
                  "  console.log('Saved rotated apiKey to env & collection');",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Batch Lookup (example workflow)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-api-key", "value": "{{apiKey}}", "type": "text" },
              { "key": "x-customer-email", "value": "{{customerEmail}}", "type": "text" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"countryCode\": \"{{countryCode}}\",\n  \"vatNumber\": \"{{vatNumber}}\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/vat/lookup", "host": ["{{baseUrl}}"], "path": ["vat", "lookup"] },
            "description": "Re-run this request in a Postman Collection Runner with a CSV of `vatNumber` values to simulate batching."
          },
          "response": []
        }
      ]
    },
    {
      "name": "2 • FAQ (inline docs)",
      "item": [
        {
          "name": "FAQ — Read Me",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "https://example.invalid/", "host": ["example","invalid"] },
            "description": "### Frequently Asked Questions\n\n**Which countries?** All EU member states supported by VIES.\n\n**Required headers?** `x-api-key` and `x-customer-email`.\n\n**Caching?** VAT lookups are cached (S3) for ~12h. During VIES outage, cache is served and `source: \"cache\"` may appear.\n\n**Errors?** 401 `invalid_api_key`, 401 `missing_*`, 403 `access_denied`, 403 `plan_not_allowed`, 429 `rate_limit_exceeded`.\n\n**Rate limits?** 120 requests/min per key. Header `X-Rate-Remaining` may be returned.\n\n**Rotate key?** `POST /reset` with your current `x-api-key` + `x-customer-email`. Old key is revoked immediately.\n\n**Billing portal?** See Stripe portal link on the website."
          },
          "response": []
        }
      ]
    }
  ]
}
