{
  "info": {
    "_postman_id": "1f6f7a2b-0c2e-41ef-9b2c-f7f5a2b9d001",
    "name": "VATFix Plus — Public API & Reviewer Tools",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "EU VAT validation API (VIES with cache). Most users only need the **Customer API** folder.\n\nHeaders:\n• VAT API (/vat/lookup) → x-api-key + x-customer-email\n• Customer key rotation (/reset) → x-api-key + x-customer-email (no bearer required)\n• Reviewer-only endpoints (/test/issue, /reset with Bearer) → Authorization: Bearer {{issuerSecret}}\n\nBase URL: {{baseUrl}} (e.g., https://plus.vatfix.eu)"
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Sensible defaults for public use",
          "if (!pm.collectionVariables.get('baseUrl')) pm.collectionVariables.set('baseUrl', 'https://plus.vatfix.eu');",
          "if (!pm.collectionVariables.get('customerEmail')) pm.collectionVariables.set('customerEmail', 'developer@example.com');",
          "if (!pm.collectionVariables.get('countryCode')) pm.collectionVariables.set('countryCode', 'DE');",
          "if (!pm.collectionVariables.get('vatNumber')) pm.collectionVariables.set('vatNumber', '123456789');"
        ]
      }
    }
  ],
  "variable": [
    { "key": "baseUrl", "value": "https://plus.vatfix.eu", "type": "string" },
    { "key": "apiKey", "value": "", "type": "string" },
    { "key": "customerEmail", "value": "developer@example.com", "type": "string" },
    { "key": "countryCode", "value": "DE", "type": "string" },
    { "key": "vatNumber", "value": "123456789", "type": "string" },
    { "key": "issuerSecret", "value": "", "type": "string" }
  ],
  "item": [
    {
      "name": "Customer API",
      "description": "For paying customers & normal users. No Authorization bearer header required.",
      "item": [
        {
          "name": "Lookup VAT",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-api-key", "value": "{{apiKey}}", "type": "text" },
              { "key": "x-customer-email", "value": "{{customerEmail}}", "type": "text" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"countryCode\": \"{{countryCode}}\",\n  \"vatNumber\": \"{{vatNumber}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/vat/lookup",
              "host": ["{{baseUrl}}"],
              "path": ["vat", "lookup"]
            },
            "description": "Validate a VAT ID. Returns VIES or cached result. Requires x-api-key + x-customer-email."
          },
          "response": [
            {
              "name": "200 OK — Valid (example)",
              "code": 200,
              "status": "OK",
              "_postman_previewlanguage": "json",
              "header": [{ "key": "Content-Type", "value": "application/json" }],
              "body": "{\n  \"countryCode\": \"DE\",\n  \"vatNumber\": \"123456789\",\n  \"valid\": true,\n  \"name\": \"ACME GmbH\",\n  \"address\": \"Berlin, Germany\",\n  \"requestDate\": \"2025-08-27+02:00\",\n  \"source\": \"vies\"\n}"
            },
            {
              "name": "200 OK — Invalid (example)",
              "code": 200,
              "status": "OK",
              "_postman_previewlanguage": "json",
              "header": [{ "key": "Content-Type", "value": "application/json" }],
              "body": "{\n  \"countryCode\": \"DE\",\n  \"vatNumber\": \"123456789\",\n  \"valid\": false,\n  \"name\": \"\",\n  \"address\": \"\",\n  \"requestDate\": \"2025-08-27+02:00\",\n  \"source\": \"vies\"\n}"
            },
            {
              "name": "401 — invalid_api_key",
              "code": 401,
              "status": "Unauthorized",
              "_postman_previewlanguage": "json",
              "body": "{\n  \"error\": \"invalid_api_key\"\n}"
            },
            {
              "name": "401 — missing_customer_email",
              "code": 401,
              "status": "Unauthorized",
              "_postman_previewlanguage": "json",
              "body": "{\n  \"error\": \"missing_customer_email\"\n}"
            },
            {
              "name": "403 — access_denied",
              "code": 403,
              "status": "Forbidden",
              "_postman_previewlanguage": "json",
              "body": "{\n  \"error\": \"access_denied\"\n}"
            },
            {
              "name": "429 — rate_limit_exceeded",
              "code": 429,
              "status": "Too Many Requests",
              "_postman_previewlanguage": "json",
              "body": "{\n  \"error\": \"rate_limit_exceeded\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 200', () => pm.expect(pm.response.code).to.eql(200));",
                  "const json = pm.response.json();",
                  "pm.test('Has valid flag', () => pm.expect(json).to.have.property('valid'));",
                  "const remaining = pm.response.headers.get('X-Rate-Remaining');",
                  "if (remaining) console.log('X-Rate-Remaining:', remaining);"
                ]
              }
            }
          ]
        },
        {
          "name": "Reset Key (customer rotation)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-api-key", "value": "{{apiKey}}", "type": "text" },
              { "key": "x-customer-email", "value": "{{customerEmail}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/reset",
              "host": ["{{baseUrl}}"],
              "path": ["reset"]
            },
            "description": "Rotate your customer key instantly; old key is revoked. No Authorization bearer header needed."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 200', () => pm.expect(pm.response.code).to.eql(200));",
                  "const json = pm.response.json();",
                  "pm.test('Rotated true + new apiKey', () => {",
                  "  pm.expect(json).to.have.property('apiKey');",
                  "  pm.expect(json.rotated).to.eql(true);",
                  "});",
                  "if (json.apiKey) {",
                  "  pm.collectionVariables.set('apiKey', json.apiKey);",
                  "  pm.environment.set('apiKey', json.apiKey);",
                  "  console.log('Saved rotated apiKey (customer)');",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Reviewer-only (ignore if you are a customer)",
      "description": "Endpoints used by platform reviewers. Require Authorization: Bearer {{issuerSecret}}.",
      "item": [
        {
          "name": "1) Issue Test Key (integration)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{issuerSecret}}", "type": "text" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{customerEmail}}\",\n  \"label\": \"Reviewer Key\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/test/issue",
              "host": ["{{baseUrl}}"],
              "path": ["test", "issue"]
            },
            "description": "Issues a reviewer integration key (not billed)."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('201/200 Created', () => pm.expect([200,201]).to.include(pm.response.code));",
                  "const json = pm.response.json();",
                  "pm.test('Includes apiKey', () => pm.expect(json).to.have.property('apiKey'));",
                  "if (json.apiKey) {",
                  "  pm.collectionVariables.set('apiKey', json.apiKey);",
                  "  pm.environment.set('apiKey', json.apiKey);",
                  "  console.log('Saved apiKey (reviewer)');",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "2) Rotate Key (integration)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{issuerSecret}}", "type": "text" },
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-api-key", "value": "{{apiKey}}", "type": "text" },
              { "key": "x-customer-email", "value": "{{customerEmail}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/reset",
              "host": ["{{baseUrl}}"],
              "path": ["reset"]
            },
            "description": "Rotate a reviewer integration key. Requires bearer token."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 200', () => pm.expect(pm.response.code).to.eql(200));",
                  "const json = pm.response.json();",
                  "pm.test('Rotated + new apiKey', () => {",
                  "  pm.expect(json).to.have.property('apiKey');",
                  "  pm.expect(json.rotated).to.eql(true);",
                  "});",
                  "if (json.apiKey) {",
                  "  pm.collectionVariables.set('apiKey', json.apiKey);",
                  "  pm.environment.set('apiKey', json.apiKey);",
                  "  console.log('Saved rotated apiKey (reviewer)');",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Status & Docs",
      "item": [
        {
          "name": "Status JSON",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{baseUrl}}/status.json", "host": ["{{baseUrl}}"], "path": ["status.json"] },
            "description": "Simple health probe."
          },
          "response": []
        },
        {
          "name": "Marketing / Docs",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{baseUrl}}/", "host": ["{{baseUrl}}"], "path": [""] },
            "description": "Marketing homepage & Quickstart."
          },
          "response": []
        }
      ]
    }
  ]
}
  